{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useState, useContext, useEffect } from 'react';\nimport { CartContext } from '../context/CartContext';\nimport './Products.css';\nimport { createClient } from '@supabase/supabase-js';\nconst supabaseUrl = 'https://cslnkpnxwqahipwrjqna.supabase.co';\nconst supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzbG5rcG54d3FhaGlwd3JqcW5hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2MzAxNDksImV4cCI6MjA1NTIwNjE0OX0.jqJ9wbyVFx09RvlNXnLZipCzFvjY2RTfcbO4XoiTfU8';\nconst supabase = createClient(supabaseUrl, supabaseKey);\nconst Products = () => {\n  _s();\n  const {\n    addToCart\n  } = useContext(CartContext);\n  const [search, setSearch] = useState('');\n  const [category, setCategory] = useState('All');\n  const [selectedProduct, setSelectedProduct] = useState(null);\n  const [quantity, setQuantity] = useState(1);\n  const [sortOption, setSortOption] = useState('default');\n  const [productsList, setProductsList] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const fetchProducts = async () => {\n      try {\n        setLoading(true);\n        const {\n          data,\n          error\n        } = await supabase.from('products').select('*').gt('quantity', 0);\n        if (error) throw error;\n        setProductsList(data.map(item => ({\n          ...item,\n          price: Number(item.price) || 0,\n          quantity: Number(item.quantity) || 0\n        })));\n      } catch (err) {\n        setError(err.message);\n        console.error('Error fetching products:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchProducts();\n    const channel = supabase.channel('products-changes').on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: 'products'\n    }, payload => {\n      if (payload.eventType === 'UPDATE') {\n        setProductsList(prev => prev.map(p => p.id === payload.new.id ? {\n          ...payload.new,\n          price: Number(payload.new.price) || 0,\n          quantity: Number(payload.new.quantity) || 0\n        } : p));\n      }\n    }).subscribe();\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, []);\n  const handleAddToCart = async product => {\n    try {\n      const numQuantity = Number(quantity) || 1;\n      const numPrice = Number(product.price) || 0;\n      const numStock = Number(product.quantity) || 0;\n      if (numQuantity <= 0) {\n        alert('Please enter a valid quantity');\n        return;\n      }\n      if (numQuantity > numStock) {\n        alert(`Only ${numStock} items available in stock`);\n        return;\n      }\n      const updatedProducts = productsList.map(p => p.id === product.id ? {\n        ...p,\n        quantity: numStock - numQuantity\n      } : p);\n      setProductsList(updatedProducts);\n      const {\n        error: updateError\n      } = await supabase.from('products').update({\n        quantity: numStock - numQuantity\n      }).eq('id', product.id);\n      if (updateError) throw updateError;\n      addToCart({\n        ...product,\n        price: numPrice,\n        quantity: numQuantity\n      });\n      setSelectedProduct(null);\n      setQuantity(1);\n    } catch (err) {\n      console.error('Error updating product quantity:', err);\n      setProductsList(productsList);\n      alert('Failed to update product quantity. Please try again.');\n    }\n  };\n\n  // ... rest of the Products component remains the same ...\n};\n_s(Products, \"KERk0QjVzpKOWaeXdFd6jsDqn1E=\");\n_c = Products;\nexport default Products;\nvar _c;\n$RefreshReg$(_c, \"Products\");","map":{"version":3,"names":["React","useState","useContext","useEffect","CartContext","createClient","supabaseUrl","supabaseKey","supabase","Products","_s","addToCart","search","setSearch","category","setCategory","selectedProduct","setSelectedProduct","quantity","setQuantity","sortOption","setSortOption","productsList","setProductsList","loading","setLoading","error","setError","fetchProducts","data","from","select","gt","map","item","price","Number","err","message","console","channel","on","event","schema","table","payload","eventType","prev","p","id","new","subscribe","removeChannel","handleAddToCart","product","numQuantity","numPrice","numStock","alert","updatedProducts","updateError","update","eq","_c","$RefreshReg$"],"sources":["D:/PROJECTS/new consultancy project/velava-super-stores/src/components/Products.js"],"sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\r\nimport { CartContext } from '../context/CartContext';\r\nimport './Products.css';\r\nimport { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = 'https://cslnkpnxwqahipwrjqna.supabase.co';\r\nconst supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzbG5rcG54d3FhaGlwd3JqcW5hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2MzAxNDksImV4cCI6MjA1NTIwNjE0OX0.jqJ9wbyVFx09RvlNXnLZipCzFvjY2RTfcbO4XoiTfU8';\r\nconst supabase = createClient(supabaseUrl, supabaseKey);\r\n\r\nconst Products = () => {\r\n  const { addToCart } = useContext(CartContext);\r\n  const [search, setSearch] = useState('');\r\n  const [category, setCategory] = useState('All');\r\n  const [selectedProduct, setSelectedProduct] = useState(null);\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [sortOption, setSortOption] = useState('default');\r\n  const [productsList, setProductsList] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchProducts = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const { data, error } = await supabase\r\n          .from('products')\r\n          .select('*')\r\n          .gt('quantity', 0);\r\n        \r\n        if (error) throw error;\r\n        \r\n        setProductsList(data.map(item => ({\r\n          ...item,\r\n          price: Number(item.price) || 0,\r\n          quantity: Number(item.quantity) || 0\r\n        })));\r\n      } catch (err) {\r\n        setError(err.message);\r\n        console.error('Error fetching products:', err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchProducts();\r\n\r\n    const channel = supabase\r\n      .channel('products-changes')\r\n      .on('postgres_changes', {\r\n        event: '*',\r\n        schema: 'public',\r\n        table: 'products'\r\n      }, (payload) => {\r\n        if (payload.eventType === 'UPDATE') {\r\n          setProductsList(prev => \r\n            prev.map(p => p.id === payload.new.id ? {\r\n              ...payload.new,\r\n              price: Number(payload.new.price) || 0,\r\n              quantity: Number(payload.new.quantity) || 0\r\n            } : p)\r\n          );\r\n        }\r\n      })\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, []);\r\n\r\n  const handleAddToCart = async (product) => {\r\n    try {\r\n      const numQuantity = Number(quantity) || 1;\r\n      const numPrice = Number(product.price) || 0;\r\n      const numStock = Number(product.quantity) || 0;\r\n\r\n      if (numQuantity <= 0) {\r\n        alert('Please enter a valid quantity');\r\n        return;\r\n      }\r\n\r\n      if (numQuantity > numStock) {\r\n        alert(`Only ${numStock} items available in stock`);\r\n        return;\r\n      }\r\n\r\n      const updatedProducts = productsList.map(p => \r\n        p.id === product.id ? { ...p, quantity: numStock - numQuantity } : p\r\n      );\r\n      setProductsList(updatedProducts);\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('products')\r\n        .update({ quantity: numStock - numQuantity })\r\n        .eq('id', product.id);\r\n      \r\n      if (updateError) throw updateError;\r\n\r\n      addToCart({\r\n        ...product,\r\n        price: numPrice,\r\n        quantity: numQuantity\r\n      });\r\n\r\n      setSelectedProduct(null);\r\n      setQuantity(1);\r\n\r\n    } catch (err) {\r\n      console.error('Error updating product quantity:', err);\r\n      setProductsList(productsList);\r\n      alert('Failed to update product quantity. Please try again.');\r\n    }\r\n  };\r\n\r\n  // ... rest of the Products component remains the same ...\r\n};\r\n\r\nexport default Products;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}